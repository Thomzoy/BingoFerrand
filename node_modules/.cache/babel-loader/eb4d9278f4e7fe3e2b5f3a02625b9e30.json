{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"/home/thomas/Code/BingoFerrand/node_modules/@babel/runtime/helpers/classCallCheck.js\")[\"default\"];\n\nvar _createClass = require(\"/home/thomas/Code/BingoFerrand/node_modules/@babel/runtime/helpers/createClass.js\")[\"default\"];\n\nrequire(\"core-js/modules/es.array.splice.js\");\n\nvar HTML = require('../common/html'); //Aliases\n\n\nvar $ = HTML.TAG_NAMES;\nvar NS = HTML.NAMESPACES; //Element utils\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\n\nfunction isImpliedEndTagRequired(tn) {\n  switch (tn.length) {\n    case 1:\n      return tn === $.P;\n\n    case 2:\n      return tn === $.RB || tn === $.RP || tn === $.RT || tn === $.DD || tn === $.DT || tn === $.LI;\n\n    case 3:\n      return tn === $.RTC;\n\n    case 6:\n      return tn === $.OPTION;\n\n    case 8:\n      return tn === $.OPTGROUP;\n  }\n\n  return false;\n}\n\nfunction isImpliedEndTagRequiredThoroughly(tn) {\n  switch (tn.length) {\n    case 1:\n      return tn === $.P;\n\n    case 2:\n      return tn === $.RB || tn === $.RP || tn === $.RT || tn === $.DD || tn === $.DT || tn === $.LI || tn === $.TD || tn === $.TH || tn === $.TR;\n\n    case 3:\n      return tn === $.RTC;\n\n    case 5:\n      return tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD;\n\n    case 6:\n      return tn === $.OPTION;\n\n    case 7:\n      return tn === $.CAPTION;\n\n    case 8:\n      return tn === $.OPTGROUP || tn === $.COLGROUP;\n  }\n\n  return false;\n}\n\nfunction isScopingElement(tn, ns) {\n  switch (tn.length) {\n    case 2:\n      if (tn === $.TD || tn === $.TH) {\n        return ns === NS.HTML;\n      } else if (tn === $.MI || tn === $.MO || tn === $.MN || tn === $.MS) {\n        return ns === NS.MATHML;\n      }\n\n      break;\n\n    case 4:\n      if (tn === $.HTML) {\n        return ns === NS.HTML;\n      } else if (tn === $.DESC) {\n        return ns === NS.SVG;\n      }\n\n      break;\n\n    case 5:\n      if (tn === $.TABLE) {\n        return ns === NS.HTML;\n      } else if (tn === $.MTEXT) {\n        return ns === NS.MATHML;\n      } else if (tn === $.TITLE) {\n        return ns === NS.SVG;\n      }\n\n      break;\n\n    case 6:\n      return (tn === $.APPLET || tn === $.OBJECT) && ns === NS.HTML;\n\n    case 7:\n      return (tn === $.CAPTION || tn === $.MARQUEE) && ns === NS.HTML;\n\n    case 8:\n      return tn === $.TEMPLATE && ns === NS.HTML;\n\n    case 13:\n      return tn === $.FOREIGN_OBJECT && ns === NS.SVG;\n\n    case 14:\n      return tn === $.ANNOTATION_XML && ns === NS.MATHML;\n  }\n\n  return false;\n} //Stack of open elements\n\n\nvar OpenElementStack = /*#__PURE__*/function () {\n  function OpenElementStack(document, treeAdapter) {\n    _classCallCheck(this, OpenElementStack);\n\n    this.stackTop = -1;\n    this.items = [];\n    this.current = document;\n    this.currentTagName = null;\n    this.currentTmplContent = null;\n    this.tmplCount = 0;\n    this.treeAdapter = treeAdapter;\n  } //Index of element\n\n\n  _createClass(OpenElementStack, [{\n    key: \"_indexOf\",\n    value: function _indexOf(element) {\n      var idx = -1;\n\n      for (var i = this.stackTop; i >= 0; i--) {\n        if (this.items[i] === element) {\n          idx = i;\n          break;\n        }\n      }\n\n      return idx;\n    } //Update current element\n\n  }, {\n    key: \"_isInTemplate\",\n    value: function _isInTemplate() {\n      return this.currentTagName === $.TEMPLATE && this.treeAdapter.getNamespaceURI(this.current) === NS.HTML;\n    }\n  }, {\n    key: \"_updateCurrentElement\",\n    value: function _updateCurrentElement() {\n      this.current = this.items[this.stackTop];\n      this.currentTagName = this.current && this.treeAdapter.getTagName(this.current);\n      this.currentTmplContent = this._isInTemplate() ? this.treeAdapter.getTemplateContent(this.current) : null;\n    } //Mutations\n\n  }, {\n    key: \"push\",\n    value: function push(element) {\n      this.items[++this.stackTop] = element;\n\n      this._updateCurrentElement();\n\n      if (this._isInTemplate()) {\n        this.tmplCount++;\n      }\n    }\n  }, {\n    key: \"pop\",\n    value: function pop() {\n      this.stackTop--;\n\n      if (this.tmplCount > 0 && this._isInTemplate()) {\n        this.tmplCount--;\n      }\n\n      this._updateCurrentElement();\n    }\n  }, {\n    key: \"replace\",\n    value: function replace(oldElement, newElement) {\n      var idx = this._indexOf(oldElement);\n\n      this.items[idx] = newElement;\n\n      if (idx === this.stackTop) {\n        this._updateCurrentElement();\n      }\n    }\n  }, {\n    key: \"insertAfter\",\n    value: function insertAfter(referenceElement, newElement) {\n      var insertionIdx = this._indexOf(referenceElement) + 1;\n      this.items.splice(insertionIdx, 0, newElement);\n\n      if (insertionIdx === ++this.stackTop) {\n        this._updateCurrentElement();\n      }\n    }\n  }, {\n    key: \"popUntilTagNamePopped\",\n    value: function popUntilTagNamePopped(tagName) {\n      while (this.stackTop > -1) {\n        var tn = this.currentTagName;\n        var ns = this.treeAdapter.getNamespaceURI(this.current);\n        this.pop();\n\n        if (tn === tagName && ns === NS.HTML) {\n          break;\n        }\n      }\n    }\n  }, {\n    key: \"popUntilElementPopped\",\n    value: function popUntilElementPopped(element) {\n      while (this.stackTop > -1) {\n        var poppedElement = this.current;\n        this.pop();\n\n        if (poppedElement === element) {\n          break;\n        }\n      }\n    }\n  }, {\n    key: \"popUntilNumberedHeaderPopped\",\n    value: function popUntilNumberedHeaderPopped() {\n      while (this.stackTop > -1) {\n        var tn = this.currentTagName;\n        var ns = this.treeAdapter.getNamespaceURI(this.current);\n        this.pop();\n\n        if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6 && ns === NS.HTML) {\n          break;\n        }\n      }\n    }\n  }, {\n    key: \"popUntilTableCellPopped\",\n    value: function popUntilTableCellPopped() {\n      while (this.stackTop > -1) {\n        var tn = this.currentTagName;\n        var ns = this.treeAdapter.getNamespaceURI(this.current);\n        this.pop();\n\n        if (tn === $.TD || tn === $.TH && ns === NS.HTML) {\n          break;\n        }\n      }\n    }\n  }, {\n    key: \"popAllUpToHtmlElement\",\n    value: function popAllUpToHtmlElement() {\n      //NOTE: here we assume that root <html> element is always first in the open element stack, so\n      //we perform this fast stack clean up.\n      this.stackTop = 0;\n\n      this._updateCurrentElement();\n    }\n  }, {\n    key: \"clearBackToTableContext\",\n    value: function clearBackToTableContext() {\n      while (this.currentTagName !== $.TABLE && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML || this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML) {\n        this.pop();\n      }\n    }\n  }, {\n    key: \"clearBackToTableBodyContext\",\n    value: function clearBackToTableBodyContext() {\n      while (this.currentTagName !== $.TBODY && this.currentTagName !== $.TFOOT && this.currentTagName !== $.THEAD && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML || this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML) {\n        this.pop();\n      }\n    }\n  }, {\n    key: \"clearBackToTableRowContext\",\n    value: function clearBackToTableRowContext() {\n      while (this.currentTagName !== $.TR && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML || this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML) {\n        this.pop();\n      }\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(element) {\n      for (var i = this.stackTop; i >= 0; i--) {\n        if (this.items[i] === element) {\n          this.items.splice(i, 1);\n          this.stackTop--;\n\n          this._updateCurrentElement();\n\n          break;\n        }\n      }\n    } //Search\n\n  }, {\n    key: \"tryPeekProperlyNestedBodyElement\",\n    value: function tryPeekProperlyNestedBodyElement() {\n      //Properly nested <body> element (should be second element in stack).\n      var element = this.items[1];\n      return element && this.treeAdapter.getTagName(element) === $.BODY ? element : null;\n    }\n  }, {\n    key: \"contains\",\n    value: function contains(element) {\n      return this._indexOf(element) > -1;\n    }\n  }, {\n    key: \"getCommonAncestor\",\n    value: function getCommonAncestor(element) {\n      var elementIdx = this._indexOf(element);\n\n      return --elementIdx >= 0 ? this.items[elementIdx] : null;\n    }\n  }, {\n    key: \"isRootHtmlElementCurrent\",\n    value: function isRootHtmlElementCurrent() {\n      return this.stackTop === 0 && this.currentTagName === $.HTML;\n    } //Element in scope\n\n  }, {\n    key: \"hasInScope\",\n    value: function hasInScope(tagName) {\n      for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]);\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if (tn === tagName && ns === NS.HTML) {\n          return true;\n        }\n\n        if (isScopingElement(tn, ns)) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"hasNumberedHeaderInScope\",\n    value: function hasNumberedHeaderInScope() {\n      for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]);\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if ((tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) && ns === NS.HTML) {\n          return true;\n        }\n\n        if (isScopingElement(tn, ns)) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"hasInListItemScope\",\n    value: function hasInListItemScope(tagName) {\n      for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]);\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if (tn === tagName && ns === NS.HTML) {\n          return true;\n        }\n\n        if ((tn === $.UL || tn === $.OL) && ns === NS.HTML || isScopingElement(tn, ns)) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"hasInButtonScope\",\n    value: function hasInButtonScope(tagName) {\n      for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]);\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if (tn === tagName && ns === NS.HTML) {\n          return true;\n        }\n\n        if (tn === $.BUTTON && ns === NS.HTML || isScopingElement(tn, ns)) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"hasInTableScope\",\n    value: function hasInTableScope(tagName) {\n      for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]);\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if (ns !== NS.HTML) {\n          continue;\n        }\n\n        if (tn === tagName) {\n          return true;\n        }\n\n        if (tn === $.TABLE || tn === $.TEMPLATE || tn === $.HTML) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"hasTableBodyContextInTableScope\",\n    value: function hasTableBodyContextInTableScope() {\n      for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]);\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if (ns !== NS.HTML) {\n          continue;\n        }\n\n        if (tn === $.TBODY || tn === $.THEAD || tn === $.TFOOT) {\n          return true;\n        }\n\n        if (tn === $.TABLE || tn === $.HTML) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"hasInSelectScope\",\n    value: function hasInSelectScope(tagName) {\n      for (var i = this.stackTop; i >= 0; i--) {\n        var tn = this.treeAdapter.getTagName(this.items[i]);\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n        if (ns !== NS.HTML) {\n          continue;\n        }\n\n        if (tn === tagName) {\n          return true;\n        }\n\n        if (tn !== $.OPTION && tn !== $.OPTGROUP) {\n          return false;\n        }\n      }\n\n      return true;\n    } //Implied end tags\n\n  }, {\n    key: \"generateImpliedEndTags\",\n    value: function generateImpliedEndTags() {\n      while (isImpliedEndTagRequired(this.currentTagName)) {\n        this.pop();\n      }\n    }\n  }, {\n    key: \"generateImpliedEndTagsThoroughly\",\n    value: function generateImpliedEndTagsThoroughly() {\n      while (isImpliedEndTagRequiredThoroughly(this.currentTagName)) {\n        this.pop();\n      }\n    }\n  }, {\n    key: \"generateImpliedEndTagsWithExclusion\",\n    value: function generateImpliedEndTagsWithExclusion(exclusionTagName) {\n      while (isImpliedEndTagRequired(this.currentTagName) && this.currentTagName !== exclusionTagName) {\n        this.pop();\n      }\n    }\n  }]);\n\n  return OpenElementStack;\n}();\n\nmodule.exports = OpenElementStack;","map":{"version":3,"sources":["/home/thomas/Code/BingoFerrand/node_modules/cheerio/node_modules/parse5/lib/parser/open-element-stack.js"],"names":["HTML","require","$","TAG_NAMES","NS","NAMESPACES","isImpliedEndTagRequired","tn","length","P","RB","RP","RT","DD","DT","LI","RTC","OPTION","OPTGROUP","isImpliedEndTagRequiredThoroughly","TD","TH","TR","TBODY","TFOOT","THEAD","CAPTION","COLGROUP","isScopingElement","ns","MI","MO","MN","MS","MATHML","DESC","SVG","TABLE","MTEXT","TITLE","APPLET","OBJECT","MARQUEE","TEMPLATE","FOREIGN_OBJECT","ANNOTATION_XML","OpenElementStack","document","treeAdapter","stackTop","items","current","currentTagName","currentTmplContent","tmplCount","element","idx","i","getNamespaceURI","getTagName","_isInTemplate","getTemplateContent","_updateCurrentElement","oldElement","newElement","_indexOf","referenceElement","insertionIdx","splice","tagName","pop","poppedElement","H1","H2","H3","H4","H5","H6","BODY","elementIdx","UL","OL","BUTTON","exclusionTagName","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nconst HTML = require('../common/html');\n\n//Aliases\nconst $ = HTML.TAG_NAMES;\nconst NS = HTML.NAMESPACES;\n\n//Element utils\n\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\nfunction isImpliedEndTagRequired(tn) {\n    switch (tn.length) {\n        case 1:\n            return tn === $.P;\n\n        case 2:\n            return tn === $.RB || tn === $.RP || tn === $.RT || tn === $.DD || tn === $.DT || tn === $.LI;\n\n        case 3:\n            return tn === $.RTC;\n\n        case 6:\n            return tn === $.OPTION;\n\n        case 8:\n            return tn === $.OPTGROUP;\n    }\n\n    return false;\n}\n\nfunction isImpliedEndTagRequiredThoroughly(tn) {\n    switch (tn.length) {\n        case 1:\n            return tn === $.P;\n\n        case 2:\n            return (\n                tn === $.RB ||\n                tn === $.RP ||\n                tn === $.RT ||\n                tn === $.DD ||\n                tn === $.DT ||\n                tn === $.LI ||\n                tn === $.TD ||\n                tn === $.TH ||\n                tn === $.TR\n            );\n\n        case 3:\n            return tn === $.RTC;\n\n        case 5:\n            return tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD;\n\n        case 6:\n            return tn === $.OPTION;\n\n        case 7:\n            return tn === $.CAPTION;\n\n        case 8:\n            return tn === $.OPTGROUP || tn === $.COLGROUP;\n    }\n\n    return false;\n}\n\nfunction isScopingElement(tn, ns) {\n    switch (tn.length) {\n        case 2:\n            if (tn === $.TD || tn === $.TH) {\n                return ns === NS.HTML;\n            } else if (tn === $.MI || tn === $.MO || tn === $.MN || tn === $.MS) {\n                return ns === NS.MATHML;\n            }\n\n            break;\n\n        case 4:\n            if (tn === $.HTML) {\n                return ns === NS.HTML;\n            } else if (tn === $.DESC) {\n                return ns === NS.SVG;\n            }\n\n            break;\n\n        case 5:\n            if (tn === $.TABLE) {\n                return ns === NS.HTML;\n            } else if (tn === $.MTEXT) {\n                return ns === NS.MATHML;\n            } else if (tn === $.TITLE) {\n                return ns === NS.SVG;\n            }\n\n            break;\n\n        case 6:\n            return (tn === $.APPLET || tn === $.OBJECT) && ns === NS.HTML;\n\n        case 7:\n            return (tn === $.CAPTION || tn === $.MARQUEE) && ns === NS.HTML;\n\n        case 8:\n            return tn === $.TEMPLATE && ns === NS.HTML;\n\n        case 13:\n            return tn === $.FOREIGN_OBJECT && ns === NS.SVG;\n\n        case 14:\n            return tn === $.ANNOTATION_XML && ns === NS.MATHML;\n    }\n\n    return false;\n}\n\n//Stack of open elements\nclass OpenElementStack {\n    constructor(document, treeAdapter) {\n        this.stackTop = -1;\n        this.items = [];\n        this.current = document;\n        this.currentTagName = null;\n        this.currentTmplContent = null;\n        this.tmplCount = 0;\n        this.treeAdapter = treeAdapter;\n    }\n\n    //Index of element\n    _indexOf(element) {\n        let idx = -1;\n\n        for (let i = this.stackTop; i >= 0; i--) {\n            if (this.items[i] === element) {\n                idx = i;\n                break;\n            }\n        }\n        return idx;\n    }\n\n    //Update current element\n    _isInTemplate() {\n        return this.currentTagName === $.TEMPLATE && this.treeAdapter.getNamespaceURI(this.current) === NS.HTML;\n    }\n\n    _updateCurrentElement() {\n        this.current = this.items[this.stackTop];\n        this.currentTagName = this.current && this.treeAdapter.getTagName(this.current);\n\n        this.currentTmplContent = this._isInTemplate() ? this.treeAdapter.getTemplateContent(this.current) : null;\n    }\n\n    //Mutations\n    push(element) {\n        this.items[++this.stackTop] = element;\n        this._updateCurrentElement();\n\n        if (this._isInTemplate()) {\n            this.tmplCount++;\n        }\n    }\n\n    pop() {\n        this.stackTop--;\n\n        if (this.tmplCount > 0 && this._isInTemplate()) {\n            this.tmplCount--;\n        }\n\n        this._updateCurrentElement();\n    }\n\n    replace(oldElement, newElement) {\n        const idx = this._indexOf(oldElement);\n\n        this.items[idx] = newElement;\n\n        if (idx === this.stackTop) {\n            this._updateCurrentElement();\n        }\n    }\n\n    insertAfter(referenceElement, newElement) {\n        const insertionIdx = this._indexOf(referenceElement) + 1;\n\n        this.items.splice(insertionIdx, 0, newElement);\n\n        if (insertionIdx === ++this.stackTop) {\n            this._updateCurrentElement();\n        }\n    }\n\n    popUntilTagNamePopped(tagName) {\n        while (this.stackTop > -1) {\n            const tn = this.currentTagName;\n            const ns = this.treeAdapter.getNamespaceURI(this.current);\n\n            this.pop();\n\n            if (tn === tagName && ns === NS.HTML) {\n                break;\n            }\n        }\n    }\n\n    popUntilElementPopped(element) {\n        while (this.stackTop > -1) {\n            const poppedElement = this.current;\n\n            this.pop();\n\n            if (poppedElement === element) {\n                break;\n            }\n        }\n    }\n\n    popUntilNumberedHeaderPopped() {\n        while (this.stackTop > -1) {\n            const tn = this.currentTagName;\n            const ns = this.treeAdapter.getNamespaceURI(this.current);\n\n            this.pop();\n\n            if (\n                tn === $.H1 ||\n                tn === $.H2 ||\n                tn === $.H3 ||\n                tn === $.H4 ||\n                tn === $.H5 ||\n                (tn === $.H6 && ns === NS.HTML)\n            ) {\n                break;\n            }\n        }\n    }\n\n    popUntilTableCellPopped() {\n        while (this.stackTop > -1) {\n            const tn = this.currentTagName;\n            const ns = this.treeAdapter.getNamespaceURI(this.current);\n\n            this.pop();\n\n            if (tn === $.TD || (tn === $.TH && ns === NS.HTML)) {\n                break;\n            }\n        }\n    }\n\n    popAllUpToHtmlElement() {\n        //NOTE: here we assume that root <html> element is always first in the open element stack, so\n        //we perform this fast stack clean up.\n        this.stackTop = 0;\n        this._updateCurrentElement();\n    }\n\n    clearBackToTableContext() {\n        while (\n            (this.currentTagName !== $.TABLE && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML) ||\n            this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML\n        ) {\n            this.pop();\n        }\n    }\n\n    clearBackToTableBodyContext() {\n        while (\n            (this.currentTagName !== $.TBODY &&\n                this.currentTagName !== $.TFOOT &&\n                this.currentTagName !== $.THEAD &&\n                this.currentTagName !== $.TEMPLATE &&\n                this.currentTagName !== $.HTML) ||\n            this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML\n        ) {\n            this.pop();\n        }\n    }\n\n    clearBackToTableRowContext() {\n        while (\n            (this.currentTagName !== $.TR && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML) ||\n            this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML\n        ) {\n            this.pop();\n        }\n    }\n\n    remove(element) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            if (this.items[i] === element) {\n                this.items.splice(i, 1);\n                this.stackTop--;\n                this._updateCurrentElement();\n                break;\n            }\n        }\n    }\n\n    //Search\n    tryPeekProperlyNestedBodyElement() {\n        //Properly nested <body> element (should be second element in stack).\n        const element = this.items[1];\n\n        return element && this.treeAdapter.getTagName(element) === $.BODY ? element : null;\n    }\n\n    contains(element) {\n        return this._indexOf(element) > -1;\n    }\n\n    getCommonAncestor(element) {\n        let elementIdx = this._indexOf(element);\n\n        return --elementIdx >= 0 ? this.items[elementIdx] : null;\n    }\n\n    isRootHtmlElementCurrent() {\n        return this.stackTop === 0 && this.currentTagName === $.HTML;\n    }\n\n    //Element in scope\n    hasInScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.treeAdapter.getTagName(this.items[i]);\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n            if (tn === tagName && ns === NS.HTML) {\n                return true;\n            }\n\n            if (isScopingElement(tn, ns)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    hasNumberedHeaderInScope() {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.treeAdapter.getTagName(this.items[i]);\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n            if (\n                (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) &&\n                ns === NS.HTML\n            ) {\n                return true;\n            }\n\n            if (isScopingElement(tn, ns)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    hasInListItemScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.treeAdapter.getTagName(this.items[i]);\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n            if (tn === tagName && ns === NS.HTML) {\n                return true;\n            }\n\n            if (((tn === $.UL || tn === $.OL) && ns === NS.HTML) || isScopingElement(tn, ns)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    hasInButtonScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.treeAdapter.getTagName(this.items[i]);\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n            if (tn === tagName && ns === NS.HTML) {\n                return true;\n            }\n\n            if ((tn === $.BUTTON && ns === NS.HTML) || isScopingElement(tn, ns)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    hasInTableScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.treeAdapter.getTagName(this.items[i]);\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n            if (ns !== NS.HTML) {\n                continue;\n            }\n\n            if (tn === tagName) {\n                return true;\n            }\n\n            if (tn === $.TABLE || tn === $.TEMPLATE || tn === $.HTML) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    hasTableBodyContextInTableScope() {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.treeAdapter.getTagName(this.items[i]);\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n            if (ns !== NS.HTML) {\n                continue;\n            }\n\n            if (tn === $.TBODY || tn === $.THEAD || tn === $.TFOOT) {\n                return true;\n            }\n\n            if (tn === $.TABLE || tn === $.HTML) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    hasInSelectScope(tagName) {\n        for (let i = this.stackTop; i >= 0; i--) {\n            const tn = this.treeAdapter.getTagName(this.items[i]);\n            const ns = this.treeAdapter.getNamespaceURI(this.items[i]);\n\n            if (ns !== NS.HTML) {\n                continue;\n            }\n\n            if (tn === tagName) {\n                return true;\n            }\n\n            if (tn !== $.OPTION && tn !== $.OPTGROUP) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    //Implied end tags\n    generateImpliedEndTags() {\n        while (isImpliedEndTagRequired(this.currentTagName)) {\n            this.pop();\n        }\n    }\n\n    generateImpliedEndTagsThoroughly() {\n        while (isImpliedEndTagRequiredThoroughly(this.currentTagName)) {\n            this.pop();\n        }\n    }\n\n    generateImpliedEndTagsWithExclusion(exclusionTagName) {\n        while (isImpliedEndTagRequired(this.currentTagName) && this.currentTagName !== exclusionTagName) {\n            this.pop();\n        }\n    }\n}\n\nmodule.exports = OpenElementStack;\n"]},"metadata":{},"sourceType":"script"}